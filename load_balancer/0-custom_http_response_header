#!/usr/bin/env bash
# Configures Nginx with a custom HTTP response header
# The custom header is named X-Served-By and contains the hostname

# Update package list and install Nginx
apt-get update
apt-get install -y nginx

# Get the hostname
# shellcheck disable=SC2154
HOSTNAME=$(hostname)

# Remove old custom header configuration if it exists
sed -i '/X-Served-By/d' /etc/nginx/sites-available/default

# Add custom header to the default server block
sed -i "/server_name _;/a \\\tadd_header X-Served-By $HOSTNAME;" /etc/nginx/sites-available/default

# Create a default index.html if it doesn't exist
if [ ! -f /var/www/html/index.html ]; then
    echo "Hello World!" > /var/www/html/index.html
fi

# Test Nginx configuration
nginx -t

# Restart Nginx to apply changes
service nginx restart
